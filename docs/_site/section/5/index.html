<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8">
<meta http-equiv="x-ua-compatible" content="ie=edge">
<meta name="viewport" content="width=device-width, minimum-scale=1.0">
<title>Section 5 (Week 5)</title>

	<meta name="description" content="TensorFlow and PyTorch">


<link rel="icon" href="/favicon.ico" type="image/x-icon">
<link rel="stylesheet" href="//fonts.googleapis.com/css?family=Montserrat:400,400i,500,500i,700,700i|Noto+Sans:400,400i,700,700i|Source+Code+Pro&amp;subset=latin-ext">
<link rel="stylesheet" href="/doks-theme/assets/css/style.css">
<script type="text/javascript" async
  src="//cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML">
</script>
	</head>
	<body class="blue" data-spy="scroll" data-target=".js-scrollspy">
		
	<div class="offcanvas visible-xs">
		<ul class="offcanvas__nav">
			
				<li><a href="/papers">Papers</a></li>
			
				<li><a href="/projects">Projects</a></li>
			
				<li><a href="/sections">Sections</a></li>
			
				<li><a href="/lectures">Lectures</a></li>
			
				<li><a href="/blogs">Blogs</a></li>
			
		</ul><!-- /.offcanvas__nav -->
	</div><!-- /.offcanvas -->



	<header class="site-header">
		<div class="container">
			<div class="row">
				<div class="col-xs-12">
					
						<a href="/" class="site-header__logo">
							Deep Learning
						</a><!-- /.site-header__logo -->
					
					
						<ul class="site-header__nav hidden-xs">
							
								<li><a href="/papers">Papers</a></li>
							
								<li><a href="/projects">Projects</a></li>
							
								<li><a href="/sections">Sections</a></li>
							
								<li><a href="/lectures">Lectures</a></li>
							
								<li><a href="/blogs">Blogs</a></li>
							
						</ul><!-- /.site-header__nav -->
						<button class="offcanvas-toggle visible-xs">
							<span></span>
							<span></span>
							<span></span>
						</button><!-- /.offcanvas-toggle -->
					
				</div><!-- /.col -->
			</div><!-- /.row -->
		</div><!-- /.container -->
	</header><!-- /.site-header -->


		<div class="hero-subheader">
			<div class="container">
				<div class="row">
					<div class="col-md-7">
						<div class="align-container" data-mh>
							<div class="align-inner">
								
									<h1 class="hero-subheader__title">Section 5 (Week 5)</h1>
								
								
									<p class="hero-subheader__desc">TensorFlow and PyTorch</p>
								
								
								
							</div><!-- /.align-inner -->
						</div><!-- /.align-container -->
					</div><!-- /.col -->
				</div><!-- /.row -->
			</div><!-- /.container -->
		</div><!-- /.hero-subheader -->
		<div class="section">
			<div class="container">
				<div class="row">
					
					<div class="col-md-7">
						<div class="content">
							<h1 id="introduction">Introduction</h1>

<p>Several different deep learning frameworks exist today, each with their own strengths, weaknesses, and user base. In this section, we’ll focus on the two most popular frameworks today: TensorFlow and PyTorch.</p>

<p>The main difference between those frameworks is - code notwithstanding - the way in which they create and run computations. In general, deep learning frameworks represent neural networks as computational graphs:</p>

<table class="image">
<caption align="bottom"><small>TensorFlow Computational Graph. (<a href="https://www.TensorFlow.org/guide/graphs">source</a>)</small></caption> 
<tr><td><img src="/doks-theme/assets/images/section/5/tfgraph.png" style="" /></td></tr>
</table>

<p>Our variables, such as the weights, biases, and loss function, are graph nodes defined before training. During training, the graph is run to execute the computations.</p>

<p>TensorFlow and PyTorch, our two chosen frameworks, handle this computational graph differently. In TensorFlow, the graph is static. That means that we create and connect all the variables at the beginning, and initialize them into a static (unchanging) session. This session and graph persists and is reused: it is not rebuilt after each iteration of training, making it efficient. However, with a static graph, variable sizes have to be defined at the beginning, which can be non-convenient for some applications, such as NLP with variable length inputs.</p>

<p>On the contrary, PyTorch uses a dynamic graph. That means that the computational graph is built up dynamically, immediately after we declare variables. This graph is thus rebuilt after each iteration of training. Dynamic graphs are flexible and allow us modify and inspect the internals of the graph at any time. The main drawback is that it can take time to rebuild the graph. Either PyTorch or TensorFlow can be more efficient depending on the specific application and implementation.</p>

<p>Recently, a new version of TensorFlow, TensorFlow 2.0 Alpha, was released. This new TensorFlow uses dynamic graphs as well. We’ll take a glance at it in this section.</p>

<p>Now, let’s cover the main topics:</p>

<ol>
  <li>We’ll walk through how to build a full TensorFlow deep learning pipeline from scratch. A PyTorch notebook is also available as a comparison.</li>
  <li>We will compare and contrast PyTorch vs. TensorFlow vs. TensorFlow 2.0 code.</li>
  <li>We’ll also walk through how to run remote Jupyter notebook servers on AWS instances.</li>
</ol>

<h1 id="tensorflow-deep-learning-pipeline">TensorFlow Deep Learning Pipeline</h1>

<p>Here is an possible list of steps to implement a deep learning pipeline:</p>

<ol>
  <li>Download the dataset</li>
  <li>Load and preprocess the dataset</li>
  <li>Define the model</li>
  <li>Define the loss function and optimizer</li>
  <li>Define the evaluation metric</li>
  <li>Train the network on the training data</li>
  <li>Report results on the train and test data</li>
</ol>

<p>Let’s look at a TensorFlow notebook in Colab to see how to build each of those steps.</p>

<p><a href="https://colab.research.google.com/drive/1HzN2f0Mypj0r2rKJdKYCjczM1WzJyoaV"><strong>TensorFlow Walkthrough</strong></a></p>

<p><a href="https://colab.research.google.com/drive/1a2KshOZVj4eqYsfFqlBHB66CUIERKHj5"><strong>PyTorch Walkthrough (for reference)</strong></a></p>

<h1 id="comparing-tensorflow-pytorch-and-tensorflow-20">Comparing TensorFlow, PyTorch, and TensorFlow 2.0</h1>

<p>The main differences between these frameworks are in the way in which variables are assigned and the computational graph is run. TensorFlow 2.0 works similarly to PyTorch.</p>

<table class="image">
<caption align="bottom"><small>TensorFlow 1 and 2. (<a href="">source</a>)</small></caption> 
<tr><td><img src="/doks-theme/assets/images/section/5/tf1and2.png" style="" /></td></tr>
</table>

<p>With TensorFlow 2.0, we don’t initialize and run a session with placeholders. Instead, the computational graph is built up dynamically as we declare variables, and calling a function with an input runs the graph and provides the output, like a standard Python function.</p>

<table class="image">
<caption align="bottom"><small>TensorFlow 1. (<a href="">source</a>)</small></caption> 
<tr><td><img src="/doks-theme/assets/images/section/5/tf1.png" style="" /></td></tr>
</table>

<table class="image">
<caption align="bottom"><small>TensorFlow 2. (<a href="">source</a>)</small></caption> 
<tr><td><img src="/doks-theme/assets/images/section/5/tf2.png" style="" /></td></tr>
</table>

<table class="image">
<caption align="bottom"><small>PyTorch. (<a href="">source</a>)</small></caption> 
<tr><td><img src="/doks-theme/assets/images/section/5/pytorch.png" style="" /></td></tr>
</table>

<h1 id="running-jupyter-notebooks-on-an-aws-ec2-gpu-instance">Running Jupyter notebooks on an AWS EC2 GPU Instance</h1>

<p>We’ve seen in the Coursera assignments that Jupyter notebooks are useful research tools for developing and evaluating models. 
We’ll now see how to run Jupyter notebooks on EC2 instances so that you can create deep learning experiments and run them on a
GPU from anywhere.</p>

<p>This guide assumes that you’ve already launched a p2.xlarge instance with the Deep Learning Ubuntu AMI. Instructions
for doing this are provided in the <a href="https://cs230.stanford.edu/section/2"><strong>Section 2 Post</strong></a>.</p>

<h2 id="configuring-jupyter">Configuring Jupyter</h2>

<p>Before we use Jupyter, we’ll need to create a configuration file, so ssh into your instance with <code class="highlighter-rouge">ssh -i PATH_TO_PEM_FILE ubuntu@INSTANCE_IP_ADDRESS</code>
and follow these steps on your instance:</p>

<ol>
  <li>
    <p>Generate a new Jupyter config file:</p>

    <p><code class="highlighter-rouge">jupyter notebook --generate-config</code></p>
  </li>
  <li>
    <p>Edit <code class="highlighter-rouge">~/.jupyter/jupyter_notebook_config.py</code> using your text editor of choice (<code class="highlighter-rouge">nano ~/.jupyter/jupyter_notebook_config.py</code> is a good default)
and write the following at the beginning of the file before all of the commented lines:</p>
    <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>c = get_config()
c.IPKernelApp.pylab = 'inline'
c.NotebookApp.ip = '0.0.0.0'
c.NotebookApp.open_browser = False
c.NotebookApp.port = 8888
c.NotebookApp.token = ''
c.NotebookApp.password = ''
</code></pre></div>    </div>
  </li>
</ol>

<h2 id="running-jupyter">Running Jupyter</h2>

<p>Now whenever you want to start a Jupyter notebook, navigate to the directory you’re working in and run <code class="highlighter-rouge">jupyter notebook</code>.
This will run a Jupyter notebook server on port 8888 of your EC2 instance by default, and if you’d like to run it on
a different port (because you’d like to run multiple notebook servers at the same time, for example), then you can specify
the port as a command line argument: <code class="highlighter-rouge">jupyter notebook --port=8889</code>. Note that the server will be killed if your SSH session gets
disconnected, so remain logged into your instance for the rest of this guide (see the end of this post for instructions on using <code class="highlighter-rouge">tmux</code> to keep the server alive across SSH sessions).</p>

<h2 id="using-jupyter-from-your-local-browser">Using Jupyter from your local browser</h2>
<p>We’ll need to set up port forwarding on your local machine so that your browser can communicate with your
remote Jupyter server. Choose an open local port (8888 is probably fine assuming you’re not running any other
Jupyter servers on your local machine, but I’ll be using port 9000), and run the following command to start forwarding your
local port 9000 to port 8888 of the remote instance: <code class="highlighter-rouge">ssh -i PATH_TO_PEM_FILE
-fNL 9000:localhost:8888 ubuntu@INSTANCE_IP_ADDRESS</code>. Anybody on your team who would like to connect to a Jupyter notebook
on your instance will need to run that command on their local machine first.</p>

<p>In your local browser, navigate to the URL <code class="highlighter-rouge">localhost:9000</code> and you should arrive at the Jupyter dashboard. From there,
you can use the “New” button near the top right of the dashboard to create a new notebook, text file, directory, or terminal window, and you can use the “Upload”
button to transfer files from your local machine to your instance.
For Tensorflow projects you’ll likely want to use the <code class="highlighter-rouge">tensorflow_p36</code> conda environment and for PyTorch projects you can use the
<code class="highlighter-rouge">pytorch_p36</code> environment.</p>

<h2 id="optional-screentmux">(Optional) <code class="highlighter-rouge">screen</code>/<code class="highlighter-rouge">tmux</code></h2>
<p>If you want to persist processes you launch from a command line on your instance across SSH sessions so that you can disconnect
without shutting down your Jupyter server, you can use either the <code class="highlighter-rouge">screen</code> or
<code class="highlighter-rouge">tmux</code> utilities. These are good utilities to know about for managing terminal windows on remote servers, so you’re encouraged
to look up tutorials for these utilities on your own. We’ll describe an example workflow using <code class="highlighter-rouge">tmux</code>.</p>

<ol>
  <li>Create a new <code class="highlighter-rouge">tmux</code> session on your EC2 instance using <code class="highlighter-rouge">tmux</code>.</li>
  <li>Navigate to the directory you’ll be working from and start your Jupyter server with <code class="highlighter-rouge">jupyter notebook</code></li>
  <li>Detach from your <code class="highlighter-rouge">tmux</code> session with <code class="highlighter-rouge">CTRL-B D</code> (hold the Control and B keys, release both, and press the D key).</li>
  <li>Your Jupyter server will now stay up even if you log out from your instance. To verify this, logout with <code class="highlighter-rouge">exit</code> or <code class="highlighter-rouge">CTRL-D</code>.</li>
  <li>SSH back into your instance.</li>
  <li>Re-attach to your tmux session using <code class="highlighter-rouge">tmux attach</code> to verify that your Jupyter server is still running.</li>
</ol>

						</div><!-- /.content -->
					</div><!-- /.col -->
					<div class="col-md-4 col-md-offset-1">
						<div class="sections-list-wrapper">
							<div class="sections-list js-sections js-affix js-scrollspy hidden-xs hidden-sm"></div><!-- /.sections-list -->
						</div>
					</div><!-- /.col -->
					
				</div><!-- /.row -->
			</div><!-- /.container -->
		</div><!-- /.section -->
		
		<div class="js-footer-area">
			
			
	<footer class="site-footer">
		<div class="container">
			<div class="row">
				<div class="col-sm-6">
					
					
						<!-- <hr> -->
						<p class="site-footer__copyright">Copyright &copy; 2019. - Pedro Abundio Wang <br>All rights reserved.</p>
					
				</div><!-- /.col -->
				
			</div><!-- /.row -->
		</div><!-- /.container -->
	</footer><!-- /.site-footer -->


<script src="/doks-theme/assets/js/vendor/jquery.min.js"></script>
<script type="text/javascript" src="/doks-theme/assets/js/vendor/bootstrap/affix.min.js"></script>
<script type="text/javascript" src="/doks-theme/assets/js/vendor/bootstrap/scrollspy.min.js"></script>
<script type="text/javascript" src="/doks-theme/assets/js/vendor/matchHeight.min.js"></script>
<script type="text/javascript" src="/doks-theme/assets/js/scripts.min.js"></script>

		</div><!-- /.js-footer-area -->
	</body>
</html>
